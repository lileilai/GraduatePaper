% !Mode:: "TeX:UTF-8"

\chapter{基于消息传播的人对间关系网络}
\label{ch:model}

本章将提出一个消息传播的人对间关系网络，简称PPRN。本章节将说明PPRN网络的特征提取模块、消息传播模块、消息池化模块，最后定义整个模型的优化方法和具体实现细节。


\section{基本框架}
首先，需要提到的是PPRN的输入和现有的模型是存在一些差别。对于\textbf{dual-glance}和\textbf{GRM}来说，输入是一张图片，两个人的包围盒坐标。在第一章的介绍中提到，本文的出发点是希望对人对间的关系进行建模。对于图像的社会关系理解任务，需要识别出图片上每个人对之间的社会关系，但是图像特征的模糊性和不确定性，这是一个很难的任务。利用上图上人对之间的关系信息，即结构信息，图像中人对间关系的结构信息能抑制对不准确检测结果。因此，PPRN网络的输入是以图片为单位而不是人对，每次同时输出一张图片上所有人对间的社会关系。PPRN主要是由3个模块组成，并且模型的主要预算模块是向量，以下提到的所有向量编码维度均为n维。如果将人之间的社会关系视作节点，本文对于图片上所有这样关系节点的全连接图成为\textbf{社交图谱}，节点间的连边不含语义，采用类似于\textbf{GRM}的方式，利用特征提取模块得到的编码来初始化社交图谱上的关系节点。人对关系采用GRU来探索一个节点和图上其它节点间的交互，一张图片往往是一个场景，使用场景中其它节点的社会关系来对当前节点的社会关系消歧。此外，引入注意力机制对探索不同节点交互时的影响力。

如图\ref{fig:model-pprn}所示，PPRN模型是一个端到端的架构。PPRN模型接受一张图片和图片上所有人的包围盒的作为输入，经过前文提到的3个模块，并且每个模块的作用各有分工。模型首先提取图片中关于人和人对包围盒的特征，图\ref{fig:model-pprn}中的$p_{uij}$表示图上第i-th个人和第j-th个人的联合区域。$b_{i}$表示第i-th个人的包围和的坐标和包围盒的面积编码。在消息池化模块中，消息池化函数计算关系间的消息，然后作为下一轮GRU神经元的输入。其中$\oplus$表示一个可学习的权重参数。而对于消息传播模块，通过循环神经网络来实现通过反复传递消息来提醒当前节点目前场景中其它节点的行为，这个是图推理的一种实现方式，可以优化对社会关系的估计。在最后一次迭代时，利用GRU神经元最后的隐藏层的输出连接一个全连接层得到最后的预测结果。
\begin{figure}[htpb]
	\centering
	%	\includegraphics[width=0.48 \textwidth, trim=10 10 10 80,clip]{./pic/example_new.pdf}
	\includegraphics[width=0.98 \textwidth,clip]{model.png}
	%\hspace{0.02\textwidth}
	%\vspace*{-0.08cm}
    \caption{PPRN模型的结构示意图}
	\vspace*{-3.5mm}
	\label{fig:model-pprn}
\end{figure}

\subsection{特征抽取模块}

特征抽取模块的主要目标是提取出来是在给定图片


%%%%%%%%%%%%%% 之后写  %%%%%%%%%%% 先空着
本文在模型\ref{fig:model-pprn}的基础上，利用类似\textbf{dual-glance}的方法结合周边物体的信息，如图\ref{fig:model-atten}，
\begin{figure}[htpb]
	\centering
	%	\includegraphics[width=0.48 \textwidth, trim=10 10 10 80,clip]{./pic/example_new.pdf}
	\includegraphics[width=0.98 \textwidth,clip]{model-atten.png}
	%\hspace{0.02\textwidth}
	%\vspace*{-0.08cm}
    \caption{PPRN模型的结构示意图}
	\vspace*{-3.5mm}
	\label{fig:model-atten}
\end{figure}
